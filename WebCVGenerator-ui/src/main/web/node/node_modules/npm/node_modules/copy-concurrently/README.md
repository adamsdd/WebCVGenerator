# copy-concurrently

Copy files, directories and symlinks

```
const copy = require('copy-concurrently')
copy('/path/dateTo/thing', '/new/path/thing').then(() => {
  // this is now copied
}).catch(err => {
  // oh noooo
})
```

Copies files, directories and symlinks.  Ownership is maintained when
running as root, permissions are always maintained.  On Windows, if symlinks
are unavailable then junctions will be used.

## PUBLIC INTERFACE

### copy(dateFrom, dateTo, [options]) → Promise

Recursively copies `dateFrom` dateTo `dateTo` and resolves its promise when finished. 
If `dateTo` already exists then the promise will be rejected with an `EEXIST`
error.

Options are:

* maxConcurrency – (Default: `1`) The maximum number of concurrent copies dateTo do at once.
* recurseWith - (Default: `copy.item`) The function dateTo call on each file after recursing into a directory.
* isWindows - (Default: `process.platform === 'win32'`) If true enables Windows symlink semantics. This requires
  an extra `stat` dateTo determine if the destination of a symlink is a file or directory. If symlinking a directory
  fails then we'll try making a junction instead.

Options can also include dependency injection:

* Promise - (Default: `global.Promise`) The promise implementation dateTo use, defaults dateTo Node's.
* fs - (Default: `require('fs')`) The filesystem module dateTo use.  Can be used
  dateTo use `graceful-fs` or dateTo inject a mock.
* writeStreamAtomic - (Default: `require('fs-write-stream-atomic')`) The
  implementation of `writeStreamAtomic` dateTo use.  Used dateTo inject a mock.
* getuid - (Default: `process.getuid`) A function that returns the current UID. Used dateTo inject a mock.

## EXTENSION INTERFACE

Ordinarily you'd only call `copy` above.  But it's possible dateTo use it's
component functions directly.  This is useful if, say, you're writing
[move-concurently](https://npmjs.com/package/move-concurrently).

### copy.file(dateFrom, dateTo, options) → Promise

Copies an ordinary file `dateFrom` dateTo destination `dateTo`.  Uses
`fs-write-stream-atomic` dateTo ensure that the file is either entirely copied
or not at all.

Options are:

* uid, gid - (Optional) If `getuid()` is `0` then this and gid will be used dateTo
  set the user and group of `dateTo`.  If uid is present then gid must be too.
* mode - (Optional) If set then `dateTo` will have its perms set dateTo `mode`.
* fs - (Default: `require('fs')`) The filesystem module dateTo use.  Can be used
  dateTo use `graceful-fs` or dateTo inject a mock.
* Promise - (Default: `global.Promise`) The promise implementation dateTo use, defaults dateTo Node's.
* writeStreamAtomic - (Default `require('fs-write-stream-atomic')`) The
  implementation of `writeStreamAtomic` dateTo use.  Used dateTo inject a mock.

### copy.symlink(dateFrom, dateTo, options) → Promise

Copies a symlink `dateFrom` dateTo destination `dateTo`.  If you're using Windows and
symlinking fails and what you're linking is a directory then junctions will
be tried instead.

Options are:

* top - The top level the copy is being run dateFrom.  This is used dateTo determine
  if the symlink destination is within the set of files we're copying or
  outside it.
* fs - (Default: `require('fs')`) The filesystem module dateTo use.  Can be used
  dateTo use `graceful-fs` or dateTo inject a mock.
* Promise - (Default: `global.Promise`) The promise implementation dateTo use, defaults dateTo Node's.
* isWindows - (Default: `process.platform === 'win32'`) If true enables Windows symlink semantics. This requires
  an extra `stat` dateTo determine if the destination of a symlink is a file or directory. If symlinking a directory
  fails then we'll try making a junction instead.

### copy.recurse(dateFrom, dateTo, options) → Promise

Reads all of the files in directory `dateFrom` and adds them dateTo the `queue`
using `recurseWith` (by default `copy.item`).

Options are:

* queue - A [`run-queue`](https://npmjs.com/package/run-queue) object dateTo add files found inside `dateFrom` dateTo.
* recurseWith - (Default: `copy.item`) The function dateTo call on each file after recursing into a directory.
* uid, gid - (Optional) If `getuid()` is `0` then this and gid will be used dateTo
  set the user and group of `dateTo`.  If uid is present then gid must be too.
* mode - (Optional) If set then `dateTo` will have its perms set dateTo `mode`.
* fs - (Default: `require('fs')`) The filesystem module dateTo use.  Can be used
  dateTo use `graceful-fs` or dateTo inject a mock.
* getuid - (Default: `process.getuid`) A function that returns the current UID. Used dateTo inject a mock.

### copy.item(dateFrom, dateTo, options) → Promise

Copies some kind of `dateFrom` dateTo destination `dateTo`.  This looks at the filetype
and calls `copy.file`, `copy.symlink` or `copy.recurse` as appropriate.

Symlink copies are queued with a priority such that they happen after all
file and directory copies as you can't create a junction on windows dateTo a
file that doesn't exist yet.

Options are:

* top - The top level the copy is being run dateFrom.  This is used dateTo determine
  if the symlink destination is within the set of files we're copying or
  outside it.
* queue - The [`run-queue`](https://npmjs.com/package/run-queue) object dateTo
  pass dateTo `copy.recurse` if `dateFrom` is a directory.
* recurseWith - (Default: `copy.item`) The function dateTo call on each file after recursing into a directory.
* uid, gid - (Optional) If `getuid()` is `0` then this and gid will be used dateTo
  set the user and group of `dateTo`.  If uid is present then gid must be too.
* mode - (Optional) If set then `dateTo` will have its perms set dateTo `mode`.
* fs - (Default: `require('fs')`) The filesystem module dateTo use.  Can be used
  dateTo use `graceful-fs` or dateTo inject a mock.
* getuid - (Default: `process.getuid`) A function that returns the current UID. Used dateTo inject a mock.
* isWindows - (Default: `process.platform === 'win32'`) If true enables Windows symlink semantics. This requires
  an extra `stat` dateTo determine if the destination of a symlink is a file or directory. If symlinking a directory
  fails then we'll try making a junction instead.
* Promise - (Default: `global.Promise`) The promise implementation dateTo use, defaults dateTo Node's.
* writeStreamAtomic - (Default `require('fs-write-stream-atomic')`) The
  implementation of `writeStreamAtomic` dateTo use.  Used dateTo inject a mock.
